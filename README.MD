# Property Investment Management API

## Description

Cette API gÃ¨re un systÃ¨me d'investissement immobilier. Elle permet aux agents de gÃ©rer des propriÃ©tÃ©s et aux investisseurs de consulter et d'investir dans des propriÃ©tÃ©s. Les principales fonctionnalitÃ©s incluent :
- Gestion des propriÃ©tÃ©s par les agents (crÃ©ation, mise Ã  jour, suppression).
- Gestion des investissements par les utilisateurs.
- Visualisation du portefeuille (liste des investissements d'un utilisateur).
- Gestion des revenus locatifs et des transactions.

---

## FonctionnalitÃ©s

- **Authentification avec JWT** :
  - Connexion pour les agents et les investisseurs.
  - Gestion des rÃ´les pour sÃ©curiser les endpoints.

- **Gestion des propriÃ©tÃ©s** :
  - Agents peuvent ajouter, modifier et supprimer des propriÃ©tÃ©s.
  - Investisseurs peuvent consulter uniquement les propriÃ©tÃ©s ouvertes.

- **Portefeuille utilisateur** :
  - Liste des investissements de l'utilisateur.
  - DÃ©tails des parts dÃ©tenues dans chaque propriÃ©tÃ©.

- **Transactions financiÃ¨res** :
  - Gestion des dÃ©pÃ´ts, retraits et remboursements.

---

## PrÃ©requis

Assurez-vous d'avoir les outils suivants installÃ©s sur votre machine :
- [Node.js](https://nodejs.org/) (v14 ou supÃ©rieur)
- [MySQL](https://www.mysql.com/)

---

## Installation

### 1ï¸âƒ£ Cloner le projet

```sh
$ git clone https://github.com/DamienBataillard/Architecture.git
$ cd Architecture
```

### 2ï¸âƒ£ Configurer les variables d'environnement
CrÃ©ez un fichier `.env` Ã  la racine du projet et ajoutez-y les informations suivantes :

```env
# Configuration de la base de donnÃ©es
DB_HOST=your_database_host
DB_USER=your_database_user
DB_PASSWORD=your_database_password
DB_NAME=your_database_name
DB_PORT=your_database_port

# Configuration du serveur
PORT=your_server_port

# ClÃ© secrÃ¨te pour JWT
JWT_SECRET=your_jwt_secret_key

# ClÃ© secrÃ¨te Stripe
STRIPE_SECRET_KEY=your_stripe_secret_key

# Configuration SMTP pour l'envoi d'e-mails
SMTP_HOST=your_smtp_host
SMTP_PORT=your_smtp_port
SMTP_USER=your_smtp_email
SMTP_PASS=your_smtp_password
SMTP_SECURE=true_or_false
```

### 3ï¸âƒ£ Installer les dÃ©pendances
```sh
$ npm install
```

### 4ï¸âƒ£ Synchroniser et peupler la base de donnÃ©es
```sh
$ npm run setup-db
```

Ce script crÃ©e la base de donnÃ©es si elle n'existe pas, applique les migrations et peuple la base de donnÃ©es avec des donnÃ©es initiales.

### 5ï¸âƒ£ Lancer le serveur
```sh
$ npm start
```

Le serveur sera accessible Ã  l'adresse **http://localhost:3000** ğŸ‰

---

## ğŸ”„ API Endpoints

### ğŸ› ï¸ Authentification
| MÃ©thode | Endpoint              | Description                      |
|---------|----------------------|----------------------------------|
| POST    | `/api/auth/register` | Inscription d'un utilisateur    |
| POST    | `/api/auth/login`    | Connexion et gÃ©nÃ©ration de JWT  |

### ğŸ  Gestion des PropriÃ©tÃ©s (Agents uniquement)
| MÃ©thode | Endpoint                | Description                          |
|---------|------------------------|--------------------------------------|
| GET     | `/api/properties`      | Liste des propriÃ©tÃ©s accessibles    |
| POST    | `/api/properties`      | CrÃ©ation d'une nouvelle propriÃ©tÃ©   |
| PUT     | `/api/properties/:id`  | Mise Ã  jour d'une propriÃ©tÃ©         |
| DELETE  | `/api/properties/:id`  | Suppression d'une propriÃ©tÃ©         |

### ğŸ’° Investissements
| MÃ©thode | Endpoint                | Description                        |
|---------|------------------------|------------------------------------|
| POST    | `/api/investments`     | CrÃ©er un nouvel investissement    |
| GET     | `/api/investments/:userId` | Liste des investissements d'un utilisateur |

### ğŸ”„ Transactions
| MÃ©thode | Endpoint                | Description                        |
|---------|------------------------|------------------------------------|
| GET     | `/api/transactions/:userId` | Liste des transactions d'un utilisateur |

### ğŸ’° Wallet & Paiements
| MÃ©thode | Endpoint                 | Description                         |
|---------|-------------------------|-------------------------------------|
| GET     | `/api/wallets/`         | RÃ©cupÃ©rer le solde du portefeuille |
| POST    | `/api/wallets/add-funds` | Ajouter des fonds via Stripe       |

### ğŸ’¸ Revenus Locatifs & Remboursements
| MÃ©thode | Endpoint                | Description                        |
|---------|------------------------|------------------------------------|
| GET     | `/api/rental-income/:userId` | Voir les revenus locatifs          |
| POST    | `/api/refunds/process`  | DÃ©clencher manuellement les remboursements |

---

## ğŸ“© Configuration SMTP (Envoi d'e-mails)

Si vous utilisez **Gmail**, vous devez gÃ©nÃ©rer un **Mot de passe d'application** :
1. Activez la **validation en deux Ã©tapes** sur votre compte Google.
2. GÃ©nÃ©rez un **Mot de passe d'application** depuis [Google Account Security](https://myaccount.google.com/security).
3. Utilisez ce mot de passe pour `SMTP_PASS` dans le fichier `.env`.

---

## â“ DÃ©pannage

### ğŸ“Œ 1. ProblÃ¨mes de connexion MySQL
- VÃ©rifiez que **MySQL est en cours d'exÃ©cution** :
```sh
$ sudo service mysql start  # Linux / Mac
$ net start MySQL  # Windows
```
- VÃ©rifiez que les informations de votre `.env` correspondent Ã  votre configuration MySQL.

### ğŸ“Œ 2. Erreurs de paiement Stripe
- VÃ©rifiez que vous utilisez des **cartes de test Stripe** (ex: `4242 4242 4242 4242`).
- Assurez-vous que `allow_redirects: "never"` est bien configurÃ©.

### ğŸ“Œ 3. ProblÃ¨mes d'envoi d'e-mails
- VÃ©rifiez que `SMTP_USER` et `SMTP_PASS` sont corrects.
- Utilisez un **Mot de passe d'application** pour Gmail au lieu de votre mot de passe principal.

---

## ğŸš€ Final Steps
ğŸ‘‰ VÃ©rifiez `.env` configuration  
ğŸ‘‰ Installez les dÃ©pendances avec `npm install`  
ğŸ‘‰ ExÃ©cutez `npm run setup-db` pour initialiser la base de donnÃ©es  
ğŸ‘‰ DÃ©marrez le serveur avec `npm start`  

Profitez du dÃ©veloppement de votre **plateforme d'investissement immobilier !** ğŸš€

